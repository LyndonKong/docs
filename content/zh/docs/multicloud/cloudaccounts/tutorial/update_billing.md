---
title: "公有云账单对接"
date: 2021-06-11T08:22:33+08:00
weight: 20
edition: ee
description: >
    如何在var_oem_name平台上配置公有云账单信息
---

目前支持对接公有云账单的平台如下：


平台 | 对接方式 | 备注
---------|----------|---------
 阿里云 | 账单存储桶URL | 
 AWS | 账单存储桶URL | 
 Azure | 合约编号和密钥 | 
 华为云 | 账单存储桶URL | 
 腾讯云 | 账单API | 平台上无需配置
 Google | bigquery<br> 账单存储桶URL | 

## 对接账单文件

### 前提条件

- [获取云平台账单信息]({{< relref "billinfo" >}})

{{< tabs >}}

{{% tab name="阿里云"%}}

1. 在云账号页面单击列表上方 **_"新建"_** 按钮，进入新建云账号页面。
2. 选择云平台为阿里云，单击 **_"下一步：配置云账号"_** 按钮，进入配置云账号页面。
3. 云账号接入信息配置完成后，单击 **_"确定"_** 按钮，创建阿里云账号。并进入账单文件访问信息页面配置云账号的账单参数以便用户可以在费用中查看云账号的账单信息。
4. 账单文件访问信息页面选填，如不需要在{{<oem_name>}}平台查看云账号账单信息，可直接单击 **_跳过_** 按钮。如需要在{{<oem_name>}}平台中查看账单信息等，请配置相关参数，配置完成且测试通过后，单击 **_"确定"_** 按钮。
{{% alert title="注意" color="warning" %}}
如果添加的阿里云账号是新账号，请先在阿里云平台上开通OSS服务。
{{% /alert %}}
   - 云账号类型：包括主账号和关联账号，使用关联账号之前请确保主账号已导入{{<oem_name>}}平台，并在使用关联账号时选择该主账号。
   - 存储桶URL：账单文件所在存储桶的URL。
   - 文件前缀：当账单bucket中除账单文件外还存放了其他文件时，需要配置文件前缀仅获取bucket中的账单文件等。阿里云的账单文件前缀为账号ID，可在账号管理-安全设置中查看账号ID。  
   - 账单分析范围：设置平台分析云账号账单的范围。目前仅支持本平台纳管账号。
       - 本平台纳管账号：即采集主账号及主账号关联的子账号的账单信息。如该主账号仅作为其他账号的付款账号时，采集到的其他账号的账单文件将会被丢弃。
   - 立即采集账单：{{<oem_name>}}平台默认每天凌晨4点自动采集账单。开启该项后，配置完账单文件访问信息后，将会立即采集账单。
   - 时间范围：当启用立即采集账单后，支持设置时间范围，立即采集时间范围内的账单，请确保在选择的时间范围内有账单数据。建议采集1~6个月内的账单，否则会因为数据太多，造成系统压力多大影响日常采集账单的任务。
5. 单击 **_"连接测试"_** 按钮，测试输入的参数是否正确。
 

{{% /tab %}}

{{% tab name="AWS"%}}

1. 在云账号页面单击列表上方 **_"新建"_** 按钮，进入新建云账号页面。
2. 选择云平台为AWS，单击 **_"下一步：配置云账号"_** 按钮，进入配置云账号页面。
3. 云账号接入信息配置完成后，单击 **_"确定"_** 按钮，创建AWS账号。并进入账单文件访问信息页面配置云账号的账单参数以便用户可以在费用中查看云账号的账单信息。
4. 如不需要在{{<oem_name>}}平台查看云账号账单信息，可直接单击 **_跳过_** 按钮。如需要在{{<oem_name>}}平台中查看账单信息等，请配置相关参数，配置完成且测试通过后，单击 **_"确定"_** 按钮。
   - 云账号类型：包括主账号和关联账号，使用关联账号之前请确保主账号已导入{{<oem_name>}}平台，并在使用关联账号时选择该主账号。
   - 存储桶URL：账单文件所在存储桶的URL。
   - 文件前缀：当账单bucket中除账单文件外还存放了其他文件时，需要配置文件前缀仅获取bucket中的账单文件等。AWS的文件前缀为账号ID。 
   - 账单分析范围：设置平台分析云账号账单的范围。包括本平台纳管账号和所有账号。
       - 本平台纳管账号：即采集主账号及主账号关联的组织账号的账单信息。如该AWS账号仅作为其他AWS的付款账号时，采集到的其他AWS账号的账单文件将会被丢弃。
       - 所有账单：将会采集主账号的所有账单，其中无法在平台找到对应云账号的账单条目，其云订阅将会显示为“本云账号名称-该账单条目关联云账号的数字ID”。
   - 立即采集账单：{{<oem_name>}}平台默认每天凌晨4点自动采集账单。开启该项后，配置完账单文件访问信息后，将会立即采集账单。
   - 时间范围：当启用立即采集账单后，支持设置时间范围，立即采集时间范围内的账单，请确保在选择的时间范围内有账单数据。建议采集1~6个月内的账单，否则会因为数据太多，造成系统压力多大影响日常采集账单的任务。
5. 单击 **_"连接测试"_** 按钮，测试输入的参数是否正确。
{{% /tab %}}

{{% tab name="Azure"%}}

1. 在云账号页面单击列表上方 **_"新建"_** 按钮，进入新建云账号页面。
2. 选择云平台为Azure，单击 **_"下一步：配置云账号"_** 按钮，进入配置云账号页面。
3. 云账号接入信息配置完成后，单击 **_"确定"_** 按钮，创建Azure云账号，并进入账单文件访问信息页面配置云账号的账单参数以便用户可以在费用中查看云账号的账单信息。
4. EA（Enterprise Agreement）账户支出通过合约编号和密钥获取账单信息，请配置相关参数，配置完成并测试成功后，单击 **_"确定"_** 按钮。
   - 合约编号：在线高级服务协议关联的唯一标识符，V570开头的数字。
   - 密钥：API访问密钥。具体请参考[如何获取Azure合约编号和密钥](#如何获取azure合约编号和密钥)。
   - 账单分析范围：设置平台分析云账号账单的范围。包括本平台纳管账号和所有账号。
       - 本平台纳管账号：即采集主账号及主账号关联的组织账号的账单信息。如该Azure账号仅作为其他Azure的付款账号时，采集到的其他Azure账号的账单文件将会被丢弃。
       - 所有账单：将会采集主账号的所有账单，其中无法在平台找到对应云账号的账单条目，其云订阅将会显示为“本云账号名称-该账单条目关联云账号的数字ID”。
   - 立即采集账单：{{<oem_name>}}平台默认每天凌晨4点自动采集账单。开启该项后，配置完账单文件访问信息后，将会立即采集账单。
   - 时间范围：当启用立即采集账单后，支持设置时间范围，立即采集时间范围内的账单，请确保在选择的时间范围内有账单数据。建议采集1~6个月内的账单，否则会因为数据太多，造成系统压力多大影响日常采集账单的任务。
5. 单击 **_"连接测试"_** 按钮，测试输入的参数是否正确。
6. 非EA账户或无需在{{<oem_name>}}平台上管理账单数据时，可单击 **_"跳过"_** 按钮。

{{% /tab %}}

{{% tab name="华为云"%}}

1. 在云账号页面单击列表上方 **_"新建"_** 按钮，进入新建云账号页面。
2. 选择云平台为华为云，单击 **_"下一步：配置云账号"_** 按钮，进入配置云账号页面。
3. 云账号接入信息配置完成后，单击 **_"确定"_** 按钮，创建华为云账号。并进入账单文件访问信息页面配置云账号的账单参数以便用户可以在费用中查看云账号的账单信息。
4. 账单文件访问信息页面选填，如不需要在{{<oem_name>}}平台查看云账号账单信息，可直接单击 **_跳过_** 按钮。如需要在{{<oem_name>}}平台中查看账单信息等，请配置相关参数，配置完成且测试通过后，单击 **_"确定"_** 按钮。
   - 云账号类型：包括主账号和关联账号，使用关联账号之前请确保主账号已导入{{<oem_name>}}平台，并在使用关联账号时选择该主账号。
   - 存储桶URL：账单文件所在存储桶的URL。
   - 账单分析范围：设置平台分析云账号账单的范围。目前仅支持本平台纳管账号。
       - 本平台纳管账号：即采集主账号及主账号关联的子账号的账单信息。如该主账号仅作为其他账号的付款账号时，采集到的其他账号的账单文件将会被丢弃。
   - 立即采集账单：{{<oem_name>}}平台默认每天凌晨4点自动采集账单。开启该项后，配置完账单文件访问信息后，将会立即采集账单。
   - 时间范围：当启用立即采集账单后，支持设置时间范围，立即采集时间范围内的账单，请确保在选择的时间范围内有账单数据。建议采集1~6个月内的账单，否则会因为数据太多，造成系统压力多大影响日常采集账单的任务。
5. 单击 **_"连接测试"_** 按钮，测试输入的参数是否正确。

{{% /tab %}}

{{% tab name="Google"%}}

1. 在云账号页面单击列表上方 **_"新建"_** 按钮，进入新建云账号页面。
2. 选择云平台为Google，单击 **_"下一步：配置云账号"_** 按钮，进入配置云账号页面。
3. 云账号接入信息配置完成后，单击 **_"确定"_** 按钮，创建Google账号。并进入账单文件访问信息页面配置云账号的账单参数以便用户可以在费用中查看云账号的账单信息。
6. 账单文件访问信息页面选填，如不需要在{{<oem_name>}}平台查看云账号账单信息，可直接单击 **_跳过_** 按钮。如需要在{{<oem_name>}}平台中查看账单信息等，请配置相关参数，配置完成后，单击 **_"确定"_** 按钮。
   - 账单数据源：选择Google账单的存放路径，包括Bigquery和bucket两种，目前Google账单已不再支持bucket。
   - 当账单数据源选择“Bigquery”时，需要配置以下参数：
       - 云账号类型：包括主账号和关联账号，使用关联账号之前请确保主账号已导入{{<oem_name>}}平台，并在使用关联账号时选择该主账号。
       - Bigquery表ID：存储Google账单的数据集的表ID。
       - 账单分析范围：设置平台分析云账号账单的范围。目前仅支持本平台纳管账号。
           - 本平台纳管账号：即采集主账号及主账号关联的子账号的账单信息。如该主账号仅作为其他账号的付款账号时，采集到的其他账号的账单文件将会被丢弃。
   - 当账单数据源选择“Bucket”时，需要配置以下参数：
       - 云账号类型：包括主账号和关联账号，使用关联账号之前请确保主账号已导入{{<oem_name>}}平台，并在使用关联账号时选择该主账号。
       - 账单文件/存储桶URL：账单文件所在存储桶的URL。
       - 账单文件/文件前缀：即为文件导出的报告前缀信息。当账单bucket中除账单文件外还存放了其他文件时，需要配置文件前缀仅获取bucket中的账单文件等。
       - 账单分析范围：设置平台分析云账号账单的范围。目前仅支持本平台纳管账号。
           - 本平台纳管账号：即采集主账号及主账号关联的子账号的账单信息。如该主账号仅作为其他账号的付款账号时，采集到的其他账号的账单文件将会被丢弃。
       - 使用量文件/存储桶URL：即使用量所在存储桶的URL。
       - 使用量文件/文件前缀：即为设置页面的报告前缀信息。当使用量bucket中除使用量文件外还存放了其他文件时，需要配置文件前缀仅获取bucket中的使用量文件等。
   - 立即采集账单：{{<oem_name>}}平台默认每天凌晨4点自动采集账单。开启该项后，配置完账单文件访问信息后，将会立即采集账单。
   - 时间范围：当启用立即采集账单后，支持设置时间范围，立即采集时间范围内的账单，请确保在选择的时间范围内有账单数据。建议采集1~6个月内的账单，否则会因为数据太多，造成系统压力多大影响日常采集账单的任务。
8. 单击 **_"连接测试"_** 按钮，测试输入的参数是否正确。

{{% /tab %}}

{{< /tabs >}}

## 更新账单文件

该功能用于更新云账号的账号和密码信息。不同平台的云账号参数不同。不同平台账号密码获取方式请参考对应的新建云账号章节。禁用状态的云账号不支持该操作。

{{% alert title="注意" color="warning" %}}
VMware云账号暂不支持更新账号。
{{% /alert %}}

1. 在云账号列表中，分别单击不同平台云账号操作列 **_"更多"_** 按钮，选择下拉菜单 **_"更新账号密码"_** 菜单项，弹出更新账号密码对话框。
2. 修改不同平台的账号密码信息，修改完成后，单击 **_"确定"_** 按钮。

