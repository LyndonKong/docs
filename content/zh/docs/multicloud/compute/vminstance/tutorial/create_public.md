---
title: "新建公有云虚拟机"
date: 2022-01-06T15:41:35+08:00
weight: 20
description: >
    创建公有云平台虚拟机
---

### 前提条件

- 请确保已添加对应公有云平台的云账号；
- 云账号已启用且状态正常。
- 对应平台有可用的IP子网。

### web操作步骤

1. 在虚拟机列表页面，单击顶部“公有云”页签，单击列表上方 **_"新建"_** 按钮，进入新建公有云虚拟机页面。
2. 配置以下参数：
    - 指定项目：管理员和域管理员在新建虚拟机时需要指定虚拟机所属的项目。
    - 名称：设置虚拟机的名称。
        - 当设置虚拟机数量大于1时，除第一台虚拟机名称外，其他虚拟机名称都以名称-1~N表示。
        - 名称支持有序后缀占位符#，一个#占一个位置，如名称设置为host##，虚拟机数量为2，创建的虚拟机名称为host00和host01。后续创建虚拟机名称仍设置为host##，名称将沿用之前的排序，编号依次往后。
        - 名称支持表达式，表达式格式为：${变量}，如${host}，则虚拟机名称显示为创建虚拟机的宿主机的名称。详细说明请参考[主机名表达式举例说明](#主机名表达式举例说明)。
    - 备注：设置虚拟机备注。
    - 计费方式：包括按量付费、包年包月。
        - 按量付费：按虚拟机的实际使用量付费，此模式适用于设备需求量会瞬间大幅度增大的场景，价格对比包年包月要贵。
        - 包年包月：是一种预付费的模式，提前一次性支付一个月、一年乃至多年的费用，该模式适用于设备需求比较平稳的场景，价格相对按量付费更便宜。支持勾选自动续费。
        {{% alert title="注意" color="warning" %}}
- 仅国内公有云支持包年包月计费方式。
- 仅阿里云包年包月支持购买一周，当选择一周时，平台将自动选择阿里云。
- 阿里云平台按周购买的虚拟机续费周期是一周，按月购买的虚拟机续费周期是一个月，按年购买的虚拟机续费周期是一年；其他平台续费周期均为一个月。后续虚拟机在每次到期之前都会自动续费。
        {{% /alert %}}
    - 到期释放：设置新建虚拟机到期释放前的使用时长，超过设置的时间后虚拟机将会被删除放入回收站。默认不设置到期释放，用户可根据需要设置“1小时”、“6小时”、“1天”、“3天”、“1周”、“1月”或自定义使用时长。
    {{% alert title="注意" color="warning" %}}
- 公有云仅按量付费的虚拟机支持到期释放功能。
- 公有云虚拟机放入回收站后仍然收费，如虚拟机不再使用，请在回收站进行清除。
    {{% /alert %}}
    - 数量：设置创建虚拟机的数量。
    - 平台及区域：可通过地域、平台、区域、可用区确定用户可选套餐，建议选择最靠近的地域，可以降低访问时延，提高访问速度。
    {{% alert title="说明" %}}
当创建公有云平台的虚拟机选择地域后，可选平台和区域需要同时满足以下条件：

- 有对应平台的云账号，且云账号未被禁用且余额充足；
- 有对应平台区域的VPC和IP子网；
    {{% /alert %}}
    - 指定云订阅：将使用指定的云订阅在公有云平台上创建虚拟机。将根据云订阅过滤镜像、VPC和IP子网等。
    - 系统盘：根据选择的套餐情况显示并设置不同的磁盘类型、介质以及磁盘的容量大小。
    {{% alert title="注意" color="warning" %}}。
- 当在腾讯云平台创建虚拟机时，系统盘大小必须为10的倍数。否则会创建失败。
    {{% /alert %}}
  - 数据盘：可选项，可根据需求添加多块数据盘，设置磁盘的类型、介质及容量大小。磁盘可选类型同系统盘。仅第一块数据盘支持选择磁盘类型，后续添加的数据盘类型同第一块数据盘。
    {{% alert title="注意" color="warning" %}}
- 添加的数据盘仅挂载到虚拟机上，不会自动执行分区操作，需要用户远程连接虚拟机后手动分区。
    {{% /alert %}}
    - 管理员账号：显示虚拟机的管理员账号
    - 管理员密码：设置管理员密码，在Linux系统中为root用户的密码，在Windows操作系统中为administrator用户的密码。
        - 随机生成：随机生成管理员密码，用户可在虚拟机列表密码列查看复制管理员密码
        - 关联密钥：在关联密钥之前需要先新建密钥。关联密钥后，用户需要使用私钥远程登录虚拟机。
        - 保留镜像设置：管理员密码为镜像中已有的管理员密码。
        - 手工输入：可手动设置管理员密码。
    {{% alert title="说明" %}}
- 根据虚拟机所在平台不同，设置管理员密码的方式可能为以上方式的其中几种，请以界面为准。
    {{% /alert %}}
    - 网络：虚拟机的IP地址。
        - 自动调度：当选择自动调度时，将从启用自动调度的IP子网中为虚拟机分配IP地址。
        - 指定IP子网：选择VPC和IP子网，如需指定静态IP，可单击 **_"手动配置IP"_** 按钮，设置IP地址，单击 **_"确定"_** 按钮。
        - 指定调度标签：设置调度标签以及调度标签偏好。设置的调度标签偏好将会覆盖调度标签上的默认策略。根据调度标签及调度偏好选择最优的IP子网。
            - 尽量使用（prefer）：调度时优先使用拥有这种标签的IP子网。
            - 避免使用（avoid）：调度时尽量避免拥有这种标签的IP子网。
            - 禁止使用（exclude）：调度时排除拥有这种标签的IP子网。
            - 必须使用（require）：调度时必须使用拥有这种标签的IP子网。
        - 举例说明：如IP子网A绑定调度标签A，默认策略为禁止使用。IP子网B绑定调度标签B，默认策略为尽量使用。调度策略A为当虚拟机属于项目A，选择调度标签A，调度标签偏好为必须使用。
            - 当创建虚拟机时网络选择默认时，有以下两种情况。
                - 当虚拟机属于项目A时，系统将选择IP子网A为虚拟机分配IP地址。
                - 当虚拟机不属于项目A时，系统将选择IP子网B为虚拟机分配IP地址。
            - 当创建虚拟机时网络选择指定IP子网A，系统将选择IP子网A为虚拟机分配IP地址。
            - 当创建虚拟机时网络选择调度标签A，且标签偏好为必须使用，则系统会从IP子网A中为虚拟机分配一个未使用的IP地址。
    - 标签：支持为新建的虚拟机绑定标签。支持选择已有标签和新建标签。
        - 新建标签：单击列表上方 **_新建_** 按钮，设置标签键和标签值，单击 **_"添加"_** 按钮，新建标签并绑定到资源上。
        - 选择已有标签：单击 **_"已有标签"_** 按钮，选择标签键和值。

    **高级配置**：默认隐藏，可根据需求进行配置。
    - 公网IP：公网IP通过与虚拟机绑定，实现虚拟机与公网之间的通信。包含弹性公网IP和静态公网IP，弹性公网IP可以灵活与虚拟机绑定或解绑。静态公网IP则不支持与虚拟机解绑。默认为暂不绑定。当选择“新建弹性公网IP”或新建静态公网IP时，需要配置以下参数：
        - 网络计费方式：设置弹性公网IP的计费方式，包括按流量计费和按带宽计费。
            - 按流量计费：按实际传输流量收费，可限制峰值带宽避免意外流量带来的费用，当瞬间带宽超过该值时将丢包，适用于网络波动大的场合。
            - 按带宽计费：按传输速率计费，选择固定带宽，超过带宽时将丢包，适用于网络波动较小的场景。
        - 带宽：设置带宽大小。
    {{% alert title="注意" color="warning" %}}
- 除腾讯云、阿里云外的公有云平台新建虚拟机时仅支持新建弹性公网IP，腾讯云和阿里云平台新建虚拟机时支持新建弹性公网IP和静态公网IP。
- 创建AWS虚拟机时，若选择的VPC不允许外网访问，则不允许新建弹性公网IP。
- AWS、Azure、Google只支持按流量计费。
    {{% /alert %}}
    - 主机名：设置虚拟机操作系统内部的计算机名。
    - 安全组：为虚拟机设置安全组规则，安全组是一种虚拟的包过滤防火墙，通过设置安全组规则来控制关联的虚拟机是否可以被访问，以及虚拟机可访问的外部资源等。一个虚拟机最多支持绑定5个安全组。
    - 调度策略：仅支持默认调度策略。

### 主机名表达式举例说明

虚拟机名称支持表达式，表达式格式为：${变量名}，变量名需要小写。如${host}，则虚拟机名称显示为创建虚拟机的宿主机的名称；${region}-${zone}，则显示为区域名-可用区名称等。

支持的变量名如下：

变量名| 举例| 说明
---------|----------|---------
 brand | aliyun | 品牌
 charge_type | postpaid | 计费方式
 cloud_env | onpremise/public/private | 用于区分本地IDC、私有云和公有云平台
 cloudregion_id | default | 区域id
 cpu | 1 | CPU数量
 host | gobuild | 主机名
 host_id | 16f49f8a-88cc-4715-8870-f78130196fa9| 主机id
 ip_addr | 192.168.1.1 | IP地址
 mem | 1024 | 内存
 os_distribution	 | 操作系统 | CentOS
 os_type | Linux | 操作系统类型
 os_version | 6.9 | 操作系统版本
 owner_tenant	 | system | 项目
 owner_tenant_id | d56f5c37e36a42b782d7f32b19497c4c | 项目id
 provider | OpenStack | 提供方
 region | Default | 区域
 region_id | kvm | 虚拟化方式
 res_name | server | 资源类别
 template_id | 5199f56b-01c2-425c-8e29-0179d283e4a3| 模板id
 zone | zone1 | 可用区
 zone_id | 00f3f3c6-1d16-4053-81f1-4cb092f418f5| 可用区id