---
title: "新建OAuth2认证源"
date: 2021-12-06T15:34:58+08:00
weight: 50
edition: ee
description: >
    新建OAuth2认证源，包括钉钉、飞书、企业微信
---

### 新建飞书认证源

#### 前提条件

{{% alert title="说明" %}}
更多内容请参考[飞书官网文档](https://open.feishu.cn/document/uQjL04CN/ucDOz4yN4MjL3gzM)
{{% /alert %}}

1. 企业用户（无需管理员用户）登录[飞书开放平台](https://open.feishu.cn/) 。
2. 在左侧导航栏，选择 **_"认证与安全/认证体系/我的应用"_** 菜单项，进入我的应用页面。
2. 创建企业自建应用。

    ![](../../../images/feishuappcreate.png)

3. 在新建应用的“凭证与基础信息”页面获取应用凭证。 
 
    ![](../../../images/feishussoappkey.png)

4. 在应用功能-网页中启用网页，并在网页配置中的桌面版主页添加平台的访问地址。
   
    ![](../../../images/feishussohtml.png)

5. 在安全设置中的重定向URL中配置回调地址或域名“https://<域名>/api/v1/auth/ssologin”。

{{% alert title="说明" %}}
- 将平台设置为域名访问，在全局设置-控制台地址中设置访问域名。
- 在{{<oem_name>}}平台认证源页面可查看平台的回调地址。
{{% /alert %}}
    ![](../../../images/feishussoredirecturl.png)

6. 在权限管理中根据需要为应用添加权限，至少添加“获取用户邮箱”、“获取用户手机号”、“获取用户userid”、“获取用户基本信息”、“获取用户统一ID”。

    ![](../../../images/feishussoauthority.png)

7. 在左侧导航栏，选择 **_"认证与安全/认证体系/版本管理与发布"_** 菜单项，进入版本管理与发布页面。
2. 创建版本，配置相关信息，注意将可用性状态设置为“所有员工”或应用适用的组织，单击 **_"保存"_** 按钮，待管理员审核发布应用。 

    ![](../../../images/feishuapp.png)

#### 操作步骤

1. 在左侧导航栏，选择 **_"认证与安全/认证体系/认证源"_** 菜单项，进入认证源页面。
2. 单击列表上方 **_"新建"_** 按钮，进入新建认证源页面。
2. 配置以下参数：
    - 认证源归属：设置认证源的归属范围，当认证源归属于系统时，即系统中所有用户都可以使用该认证源登录平台。当认证源归属于域时，只有该域中的用户可以使用该认证源登录平台。域管理后台下，认证源归属于域管理员所属域。
    - 名称：认证源的名称。
    - 认证协议：选择“OAuth2”。
    - 认证类型：支持飞书、钉钉、企业微信等。
    - 当认证类型是飞书时：
        - AppId：应用的id标识。
        - Secret：应用的密钥，创建app的时候由飞书开放平台生成。
    - 用户归属目标域：勾选自动创建用户后才需要设置该参数。选择通过该认证方式登录自动创建的用户所属的域，当认证源归属于域时，用户归属目标域与认证源归属域一致，不可更改。

    **高级配置**：默认隐藏，可根据需求进行配置。

    - 默认项目：设置通过OAuth2认证协议的认证源登录并在平台自动创建的用户加入的默认项目。
    - 默认角色：设置通过OAuth2认证协议的认证源登录并在平台自动创建的用户加入的默认角色。


### 新建钉钉认证源

#### 前提条件

{{% alert title="说明" %}}
更多内容请参考[钉钉官网文档](https://ding-doc.dingtalk.com/doc#/bgb96b/ok9au2)
{{% /alert %}}

1. 以管理员登录[钉订开放平台](https://open.dingtalk.com/)。
2. 在在“应用开发”页面的移动接入应用-登录页面中创建扫码登录应用授权。

    ![](../../../images/dingdingssocreate.png)

3. 配置回调域名为“https://<域名>/api/v1/auth/ssologin”。
{{% alert title="说明" %}}
- 将平台设置为域名访问，在全局设置-控制台地址中设置访问域名。
- 在{{<oem_name>}}平台认证源页面可查看平台的回调地址。
{{% /alert %}}
4. 创建完成后，可以获取对应的AppId和AppSecret。

    ![](../../../images/dingdingssoappkey.png)

#### 操作步骤

1. 在左侧导航栏，选择 **_"认证与安全/认证体系/认证源"_** 菜单项，进入认证源页面。
2. 单击列表上方 **_"新建"_** 按钮，进入新建认证源页面。
2. 配置以下参数：
    - 认证源归属：设置认证源的归属范围，当认证源归属于系统时，即系统中所有用户都可以使用该认证源登录平台。当认证源归属于域时，只有该域中的用户可以使用该认证源登录平台。域管理后台下，认证源归属于域管理员所属域。
    - 名称：认证源的名称。
    - 认证协议：选择“OAuth2”。
    - 认证类型：支持飞书、钉钉、企业微信等。
    - 当认证类型是钉钉时：
        - AppId：应用的id标识。
        - AppSecret：应用的密钥，创建扫码登录应用授权的时候由钉钉开放平台生成。
    - 用户归属目标域：勾选自动创建用户后才需要设置该参数。选择通过该认证方式登录自动创建的用户所属的域，当认证源归属于域时，用户归属目标域与认证源归属域一致，不可更改。

    **高级配置**：默认隐藏，可根据需求进行配置。

    - 默认项目：设置通过OAuth2认证协议的认证源登录并在平台自动创建的用户加入的默认项目。
    - 默认角色：设置通过OAuth2认证协议的认证源登录并在平台自动创建的用户加入的默认角色。


### 新建企业微信认证源

#### 前提条件

1. 以管理员用户登录[企业微信管理后台](https://work.weixin.qq.com/wework_admin/loginpage_wx?from=myhome_baidu)
   
2. 在顶部-我的企业页面中获取企业ID。

    ![](../../../images/workweixincorpid.png)

3. 在顶部-应用管理页签下，选择应用-创建自建应用，并配置应用的logo、名称、应用介绍以及可见范围，可见范围建议设置为“所有员工”或应用适用的组织。

    ![](../../../images/workweixincreate.png)

4. 在开发者接口-企业微信授权登录中设置Web网页的授权回调域为域名地址。
{{% alert title="说明" %}}
- 将平台设置为域名访问，在全局设置-控制台地址中设置访问域名为https://<域名>。
- 在{{<oem_name>}}平台认证源页面可查看平台的回调地址，在企业微信中只需要填写域名即可。
{{% /alert %}}
    ![](../../../images/workweixinssoauth.png)
    ![](../../../images/workweixinssowebauth.png)

5. 在应用详情中获取AgentId和Secret信息。

    ![](../../../images/workweixinssoappkey.png)

#### 操作步骤

1. 在左侧导航栏，选择 **_"认证与安全/认证体系/认证源"_** 菜单项，进入认证源页面。
2. 单击列表上方 **_"新建"_** 按钮，进入新建认证源页面。
2. 配置以下参数：
    - 认证源归属：设置认证源的归属范围，当认证源归属于系统时，即系统中所有用户都可以使用该认证源登录平台。当认证源归属于域时，只有该域中的用户可以使用该认证源登录平台。域管理后台下，认证源归属于域管理员所属域。
    - 名称：认证源的名称。
    - 认证协议：选择“OAuth2”。
    - 认证类型：支持飞书、钉钉、企业微信等。
    - 当认证类型是企业微信时：
        - 企业ID：用于标识企业。
        - AgentID：应用的id标识。
        - Secret：应用的密钥。
    - 用户归属目标域：勾选自动创建用户后才需要设置该参数。选择通过该认证方式登录自动创建的用户所属的域，当认证源归属于域时，用户归属目标域与认证源归属域一致，不可更改。

    **高级配置**：默认隐藏，可根据需求进行配置。

    - 默认项目：设置通过OAuth2认证协议的认证源登录并在平台自动创建的用户加入的默认项目。
    - 默认角色：设置通过OAuth2认证协议的认证源登录并在平台自动创建的用户加入的默认角色。