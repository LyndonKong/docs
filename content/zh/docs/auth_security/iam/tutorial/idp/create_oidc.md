---
title: "新建OIDC认证源"
date: 2021-12-06T15:35:06+08:00
weight: 40
edition: ee
description: >
    新建OIDC认证源，包括Github、Azure AD OAuth2
---

### 新建通用OIDC认证源

1. 在左侧导航栏，选择 **_"认证与安全/认证体系/认证源"_** 菜单项，进入认证源页面。
2. 单击列表上方 **_"新建"_** 按钮，进入新建认证源页面。
2. 配置以下参数：
    - 认证源归属：设置认证源的归属范围，当认证源归属于系统时，即系统中所有用户都可以使用该认证源登录平台。当认证源归属于域时，只有该域中的用户可以使用该认证源登录平台。域管理后台下，认证源归属于域管理员所属域。
    - 名称：设置认证源的名称。
    - 备注：设置认证源的备注信息。
    - 认证协议：选择“OIDC”。
    - 认证类型：支持通用OIDC、Github、Azure AD OAuth2。不同认证类型配置的参数不同。
    - 当认证类型是通用OIDC时：该功能要求用户环境中存在OIDC服务器等。
        - ClientID：第三方应用程序的一个标识id，这个信息通常是公开的信息，用来区分哪一个第三方应用程序。
        - ClientSecret：第三方应用程序的私钥信息，这个信息是私密的信息，不允许在OAuth2流程中传递的，用于安全方面的检测和加密。
        - Endpoint：Endpoint即包含OIDC协议所需要的所有配置信息。如存在Endpoint信息，可直接勾选我有Endpoint，并将信息填入。如不存在Endpoint信息，则需要填入Scopes(授权范围)、AuthUrl、TokenUrl、UserinfoUrl。
        - 用户ID：设置通用OIDC中对应的用户ID属性，一般为name，如有变化请更改该项。
        - 用户名：设置通用OIDC中对应的用户名属性，一般为name，如有变化请更改该项。
    - 用户归属目标域：勾选自动创建用户后才需要设置该参数。选择通过该认证方式登录自动创建的用户所属的域，当认证源归属于域时，用户归属目标域与认证源归属域一致，不可更改。

    **高级配置**：默认隐藏，可根据需求进行配置。

    - 默认项目：设置通过OIDC认证协议的认证源登录并在平台自动创建的用户加入的默认项目。
    - 默认角色：设置通过OIDC认证协议的认证源登录并在平台自动创建的用户加入的默认角色。

### 新建Github认证源

#### 前提条件

1. 用户登录[Github](https://github.com)
2. 在用户信息-setting-Developersetting-OAuth2 Apps页面创建OAuth应用。

    ![](../../../images/githubsetting.png)
    ![](../../../images/githuboauth.png)

3. 配置平台的访问地址以及回调地址为“https://<域名>/api/v1/auth/ssologin”。

{{% alert title="说明" %}}
- 将平台设置为域名访问，在全局设置-控制台地址中设置访问域名。
- 在{{<oem_name>}}平台认证源页面可查看平台的回调地址。
{{% /alert %}}
    ![](../../../images/githubassocreate.png)

4. 创建成功后获取ClientID和ClientSecret。

    ![](../../../images/githubssoappkey.png)

#### 操作步骤

- 认证源归属：设置认证源的归属范围，当认证源归属于系统时，即系统中所有用户都可以使用该认证源登录平台。当认证源归属于域时，只有该域中的用户可以使用该认证源登录平台。域管理后台下，认证源归属于域管理员所属域。
    - 名称：认证源的名称。
    - 认证协议：选择“OIDC”。
    - 认证类型：支持通用OIDC、Github、Azure AD OAuth2。不同认证类型配置的参数不同。
    - 当认证类型是Github时，需要配置ClientID和ClientSecret。
    - 用户归属目标域：勾选自动创建用户后才需要设置该参数。选择通过该认证方式登录自动创建的用户所属的域，当认证源归属于域时，用户归属目标域与认证源归属域一致，不可更改。

    **高级配置**：默认隐藏，可根据需求进行配置。

    - 默认项目：设置通过OIDC认证协议的认证源登录并在平台自动创建的用户加入的默认项目。
    - 默认角色：设置通过OIDC认证协议的认证源登录并在平台自动创建的用户加入的默认角色。

### 新建Azure AD OAuth2认证源

#### 前提条件

1. 用户登录[Azure中国区](https://portal.azure.cn/)或[Azure海外区](https://portal.azure.com)。以Azure中国区为例介绍如何获取参数。
2. 在Azure Active Directory-应用注册页面，新注册应用。
    
    ![](../../../images/azureappregister.png)

3. 根据需求选择受支持的账户类型，配置重定向URI，设置为“web”以及平台回调地址为“https://<域名>/api/v1/auth/ssologin”。

{{% alert title="说明" %}}
- 将平台设置为域名访问，在全局设置-控制台地址中设置访问域名。
- 在{{<oem_name>}}平台认证源页面可查看平台的回调地址。
{{% /alert %}}
    ![](../../../images/azuressoappcreate.png)

4. 创建成功后默认进入应用程序详情页面，获取ClientID(客户端ID)和TenantID（目录/租户ID）。

    ![](../../../images/azuressoappkey.png)

5. 在左侧菜单项中选择证书和密码菜单项，新建客户端密码，添加成功后获取ClientSecret（客户端密码）。

    ![](../../../images/azuressoappsecret.png)

#### 操作步骤

1. 在左侧导航栏，选择 **_"认证与安全/认证体系/认证源"_** 菜单项，进入认证源页面。
2. 单击列表上方 **_"新建"_** 按钮，进入新建认证源页面。
2. 配置以下参数：
    - 认证源归属：设置认证源的归属范围，当认证源归属于系统时，即系统中所有用户都可以使用该认证源登录平台。当认证源归属于域时，只有该域中的用户可以使用该认证源登录平台。域管理后台下，认证源归属于域管理员所属域。
    - 名称：认证源的名称。
    - 认证协议：选择“OIDC”。
    - 认证类型：支持通用OIDC、Github、Azure AD OAuth2。不同认证类型配置的参数不同。
    - 当认证类型是Azure AD OAuth2时，需要选择Azure所在CloudEnv（中国区或全球区）、配置ClientID、ClientSecret、TenantID等。
    - 用户归属目标域：勾选自动创建用户后才需要设置该参数。选择通过该认证方式登录自动创建的用户所属的域，当认证源归属于域时，用户归属目标域与认证源归属域一致，不可更改。

    **高级配置**：默认隐藏，可根据需求进行配置。

    - 默认项目：设置通过OIDC认证协议的认证源登录并在平台自动创建的用户加入的默认项目。
    - 默认角色：设置通过OIDC认证协议的认证源登录并在平台自动创建的用户加入的默认角色。